{
  "createdAt": "2025-05-14T22:11:14.345Z",
  "updatedAt": "2025-05-14T22:11:42.356Z",
  "id": "RU25zzOZL8NP4kyI",
  "name": "RegistroAlimento",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "numero_telefone"
            },
            {
              "name": "message"
            },
            {
              "name": "diary_day_id"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "d4420f52-cd29-450f-94e8-affef2d3eba3",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=## Prompt Especializado - Registro de Alimentos\n\nVoc√™ √© o componente de Registro de Alimentos do sistema Dieta F√°cil, especializado em identificar alimentos consumidos pelo usu√°rio, classificar as refei√ß√µes, calcular macronutrientes e armazenar estas informa√ß√µes no banco de dados.\n\n##Contexto\n{{ JSON.stringify($json.context) }}\n\n### Responsabilidades Espec√≠ficas\n1. Analisar descri√ß√µes de alimentos fornecidas pelo usu√°rio\n2. Identificar e classificar as refei√ß√µes (caf√© da manh√£, almo√ßo, jantar, lanche)\n3. Calcular macronutrientes (prote√≠nas, carboidratos, gorduras, fibras) e calorias\n4. Salvar os dados identificados no banco de dados usando formato JSON espec√≠fico\n5. Preparar dados para serem exibidos no formato visual padronizado\n\n### Ferramenta de Registro de Refei√ß√µes\nUtilize a ferramenta 'Insere_Refeicao_tool' para salvar as refei√ß√µes identificadas, seguindo EXATAMENTE este formato:\n\n```\n[\n  {\n    \"alimentos\": [\n      {\n        \"name\": \"Nome do alimento\",\n        \"quantity\": \"Quantidade em unidades/medidas caseiras\",\n        \"emoji\": \"üçé\",\n        \"protein\": \"0\",\n        \"carbs\": \"0\",\n        \"fat\": \"0\",\n        \"fiber\": \"0\",\n        \"calories\": \"0\"\n      }\n      // mais alimentos se houver\n    ],\n    \"diary_day_id\": \"{{ $json.context.diary_day_id }}\",\n    \"tipo_refeicao_id\": 1  // 1=Caf√© da manh√£, 2=Almo√ßo, 3=Jantar, 4=Lanche\n  }\n]\n```\n\n### Classifica√ß√£o de Refei√ß√µes\nDetermine o tipo de refei√ß√£o baseado no contexto e hor√°rio:\n- **tipo_refeicao_id: 1** = Caf√© da manh√£ (geralmente antes das 11h)\n- **tipo_refeicao_id: 2** = Almo√ßo (geralmente entre 11h e 15h)\n- **tipo_refeicao_id: 3** = Jantar (geralmente ap√≥s as 18h)\n- **tipo_refeicao_id: 4** = Lanche (qualquer refei√ß√£o menor entre as principais)\n\n### Processo de Identifica√ß√£o de Alimentos\n1. Analisar a descri√ß√£o fornecida pelo usu√°rio\n2. Identificar cada alimento mencionado individualmente\n3. Determinar quantidade aproximada (em medidas caseiras ou gramas)\n4. Atribuir valores nutricionais com base no banco de dados nutricional\n5. Selecionar emoji apropriado para cada alimento\n\n### Exemplos de Identifica√ß√£o\n- \"Comi 2 ovos cozidos com uma fatia de p√£o integral e uma x√≠cara de caf√© preto.\"\n  - Ovos cozidos (2 unidades) ü•ö\n  - P√£o integral (1 fatia) üçû\n  - Caf√© preto (1 x√≠cara) ‚òïÔ∏è\n\n- \"Almocei arroz, feij√£o, bife e salada.\"\n  - Arroz branco (1 por√ß√£o) üçö\n  - Feij√£o (1 concha) ü´ò\n  - Bife (1 unidade m√©dia) ü•©\n  - Salada (1 por√ß√£o) ü•ó\n\n### C√°lculo de Macronutrientes\nPara cada alimento identificado, calcule:\n- Prote√≠nas (em gramas)\n- Carboidratos (em gramas)\n- Gorduras (em gramas)\n- Fibras (em gramas)\n- Calorias totais\n\n### IMPORTANTE: Formato JSON\n- 'alimentos' DEVE ser um ARRAY de OBJETOS, n√£o uma string\n- Cada alimento √© um objeto separado dentro do array\n- Todos os campos num√©ricos (protein, carbs, fat, fiber, calories) devem ser strings, n√£o n√∫meros\n- Sempre inclua o diary_day_id do contexto\n- O tipo_refeicao_id deve ser um n√∫mero (n√£o string)\n\n### Tratamento de Erros\nSe ocorrer erro ao salvar os dados:\n1. Tente novamente com formato corrigido\n2. Se persistir, informe ao componente principal sem expor detalhes t√©cnicos ao usu√°rio\n\n### Comunica√ß√£o com Outros Componentes\nAp√≥s processar os alimentos, retorne os dados no formato:\n```\n{\n  \"status\": \"registrado\",\n  \"refeicao\": {\n    \"tipo\": \"caf√© da manh√£|almo√ßo|jantar|lanche\",\n    \"alimentos\": [...],\n    \"macros\": {\n      \"proteina\": valor,\n      \"carboidrato\": valor,\n      \"gordura\": valor,\n      \"fibra\": valor,\n      \"calorias\": valor\n    }\n  }\n}\n```\n\n### Notas Importantes\n- SEMPRE utilize strings para valores num√©ricos no JSON enviado para a ferramenta\n- NUNCA tente editar refei√ß√µes j√° registradas - informe ao usu√°rio que edi√ß√µes devem ser feitas em https://dietafacil.app.br/today\n- Seja preciso nos c√°lculos nutricionais para garantir recomenda√ß√µes adequadas\n- Atribua emojis apropriados para cada alimento para melhorar a experi√™ncia visual do usu√°rio",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        640,
        0
      ],
      "id": "98cb7d28-bfd4-455c-be38-ff051f787b31",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        520,
        260
      ],
      "id": "8a3cedcc-1419-426c-a632-b65e059ea7f8",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "hDbVS33gRemwNAep",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fa7e7974-0a07-4b46-9b44-0c338f91460e",
              "name": "context.numero_telefone",
              "value": "={{ $json.numero_telefone }}",
              "type": "string"
            },
            {
              "id": "a41df30d-67ae-4aed-b282-e2d669012cdb",
              "name": "context.message",
              "value": "={{ $json.message }}",
              "type": "string"
            },
            {
              "id": "d71ee678-6309-44a9-9ac5-cf0b4cd84f60",
              "name": "context.diary_days_id",
              "value": "={{ $json.diary_day_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        300,
        0
      ],
      "id": "d827864f-52dc-43bd-adb7-40fa499e82f1",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "name": "Insere_Refeicao_tool",
        "description": "Chame essa tool para inserir refei√ß√µes",
        "workflowId": {
          "__rl": true,
          "value": "aw1gGatYG5fVkLJE",
          "mode": "list",
          "cachedResultName": "Insere_Refeicao"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "alimentos": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('alimentos', ``, 'string') }}",
            "diary_day_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('diary_day_id', ``, 'string') }}",
            "tipo_refeicao_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('tipo_refeicao_id', ``, 'number') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "alimentos",
              "displayName": "alimentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "array"
            },
            {
              "id": "diary_day_id",
              "displayName": "diary_day_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "tipo_refeicao_id",
              "displayName": "tipo_refeicao_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "number"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        1020,
        320
      ],
      "id": "3a0bfbb1-2167-428d-8f11-25c170d98dcc",
      "name": "Insere_Refeicao_tool"
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insere_Refeicao_tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "numero_telefone": "558599028259",
          "message": "Lanchei \n\n1 fatia de queijo de bufada \n1 fayia de peito de peru\n200ml de suco de abacaxi",
          "diary_day_id": "3adca60d-736b-4d31-b624-3dcb176c5f0a"
        }
      }
    ]
  },
  "versionId": "a62dead7-b3a6-4e5a-bceb-4511926d7cb8",
  "triggerCount": 0,
  "tags": [
    {
      "createdAt": "2025-05-14T21:16:03.990Z",
      "updatedAt": "2025-05-14T21:16:03.990Z",
      "id": "V2BRwlJlIUVtAHi7",
      "name": "dietaFacilRefatorado"
    }
  ]
}